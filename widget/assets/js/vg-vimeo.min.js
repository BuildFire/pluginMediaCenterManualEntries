!function(O){"use strict";O.module("rc-videogular.plugins.vimeo",[]).directive("vgVimeo",["$window","$timeout","VG_STATES","VG_UTILS","VG_VOLUME_KEY",function(P,V,S,C,A){return{restrict:"A",require:"^videogular",link:function(r,e,t,a){var u,l,m,c=0,d=0,s=!0,f=0,p=O.isDefined(t.vgVimeoFullscreen)?t.vgVimeoFullscreen:"true",g=function(){a.onUpdateTime({target:a.mediaElement[0]})},v=function(){s=!1;var e=new CustomEvent("playing");a.mediaElement[0].dispatchEvent(e),a.setState(S.PLAY)},E=function(){s=!0;var e=new CustomEvent("pause");a.mediaElement[0].dispatchEvent(e),a.setState(S.PAUSE)},y=function(){a.onComplete()},b=function(e){c=e.seconds,d=e.duration,g()},h=function(e){var t=new CustomEvent("waiting");a.mediaElement[0].dispatchEvent(t)};function w(){var e=new CustomEvent("loadedmetadata");a.mediaElement[0].dispatchEvent(e)}function n(e){if(e){var t,n,i,o=(t=e.match(/^.+vimeo.com\/(.*\/)?([^#\?]*)/))?t[2]||t[1]:null;if(o)n=o,u?i=u.element:(i=document.createElement("iframe"),O.element(a.mediaElement[0]).replaceWith(O.element(i))),i.src="https://player.vimeo.com/video/"+n+"?player_id=vimeoplayer&title=0&byline=0&portrait=0&controls=0",i.style.width="100%",i.style.height="100%",r.$eval(p)&&(i.setAttribute("webkitallowfullscreen",""),i.setAttribute("mozallowfullscreen",""),i.setAttribute("allowfullscreen","")),O.element(i.parentNode.parentNode).find("vg-overlay-play").css("height","calc(100% - 50px)"),(u=new Vimeo.Player(i)).ready().then(function(){!function(){if(Object.defineProperty(a.mediaElement[0],"currentTime",{get:function(){return c},set:function(e){c=e,u.setCurrentTime(c)},enumerable:!0,configurable:!0}),Object.defineProperty(a.mediaElement[0],"duration",{get:function(){return d},enumerable:!0,configurable:!0}),Object.defineProperty(a.mediaElement[0],"paused",{get:function(){return s},enumerable:!0,configurable:!0}),Object.defineProperty(a.mediaElement[0],"videoWidth",{get:function(){return l},enumerable:!0,configurable:!0}),Object.defineProperty(a.mediaElement[0],"videoHeight",{get:function(){return m},enumerable:!0,configurable:!0}),Object.defineProperty(a.mediaElement[0],"volume",{get:function(){return f},set:function(e){f=e,u.setVolume(f)},enumerable:!0,configurable:!0}),a.mediaElement[0].play=function(){u.play()},a.mediaElement[0].pause=function(){u.pause()},u.getVolume().then(function(e){f=e,a.onVolumeChange()}),u.getCurrentTime().then(function(e){c=e,w()}),u.getDuration().then(function(e){d=e,w()}),g(),C.supportsLocalStorage()&&0<parseFloat(P.localStorage.getItem(A)||"1")&&(a.mediaElement[0].muted=!1),a.currentState!==S.PLAY){var e=new CustomEvent("canplay");a.mediaElement[0].dispatchEvent(e),!0===a.autoPlay&&V(function(){a.play()})}else u.play().then(function(){})}()}),u.on("play",v),u.on("pause",E),u.on("ended",y),u.on("timeupdate",b),u.on("progress",h)}else u&&u.destroy()}r.$watch(function(){return a.sources},function(e,t){e&&0<e.length&&e[0].src?n(e[0].src.toString()):n(null)})}}}])}(angular);
